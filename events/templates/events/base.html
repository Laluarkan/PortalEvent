{% load static %}
{% load socialaccount %}

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="{% static 'events/images/favicon-32x32.png' %}">
    
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .hover-shadow:hover { box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important; transition: 0.3s; }
        
        .nav-profile-img {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border: 2px solid white;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-light d-flex flex-column min-vh-100">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="{% url 'home' %}">Portal Event</a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'home' %}">Beranda</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link fw-bold" href="{% url 'check_ticket' %}">Cek Tiket</a>
                    </li>

                    {% if user.is_authenticated %}
                        {% if user.is_organizer or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'organizer_dashboard' %}">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="btn btn-light text-primary btn-sm fw-bold ms-2 rounded-pill px-3" href="{% url 'create_event' %}">
                                + Buat Seminar
                            </a>
                        </li>
                        {% endif %}
                        
                        <li class="nav-item dropdown ms-3">
                            <a class="nav-link dropdown-toggle d-flex align-items-center gap-2" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                {% if user.socialaccount_set.all.0.get_avatar_url %}
                                    <img src="{{ user.socialaccount_set.all.0.get_avatar_url }}" alt="Profile" class="rounded-circle nav-profile-img shadow-sm">
                                {% else %}
                                    <img src="https://ui-avatars.com/api/?name={{ user.username }}&background=random" alt="Profile" class="rounded-circle nav-profile-img shadow-sm">
                                {% endif %}
                            </a>
                            
                            <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0 mt-2" aria-labelledby="navbarDropdown">
                                <li class="px-3 py-1 text-muted"><small>Halo, <strong>{{ display_name }}</strong></small></li>
                                <li><hr class="dropdown-divider"></li>

                                {% if user.is_superuser %}
                                <li><a class="dropdown-item" href="{% url 'admin_approval_list' %}">Validasi Seminar</a></li>
                                <li><a class="dropdown-item" href="/admin/" target="_blank">Database Admin</a></li>
                                <li><hr class="dropdown-divider"></li>
                                {% endif %}
                                <li>
                                    <a class="dropdown-item" href="{% url 'participant_dashboard' %}">
                                        Riwayat Kegiatan Saya
                                    </a>
                                </li>
                                                                
                                <li>
                                    <form method="post" action="{% url 'account_logout' %}" class="d-inline">
                                        {% csrf_token %}
                                        <button type="submit" class="dropdown-item text-danger">Keluar (Logout)</button>
                                    </form>
                                </li>
                            </ul>
                        </li>

                    {% else %}
                        <li class="nav-item ms-2">
                            <button type="button" class="btn btn-light text-primary btn-sm rounded-pill px-3 fw-bold" data-bs-toggle="modal" data-bs-target="#loginModal">
                                Masuk / Daftar
                            </button>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    {% block content_wrapper %}
        <div class="container mb-5 mt-4"> {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}

            {% block content %}{% endblock %}
        </div>
    {% endblock %}

    <footer class="text-center py-4 text-muted mt-auto border-top bg-white">
        <small>&copy; 2025 Portal-Aktifitas. All rights reserved.</small>
    </footer>

    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center p-4">
                <div class="modal-header border-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h3 class="mb-3 fw-bold">Selamat Datang!</h3>
                    <p class="text-muted mb-4">Silahkan masuk menggunakan akun Google Anda.</p>
                    <a href="{% provider_login_url 'google' %}" class="btn btn-outline-danger btn-lg w-100 shadow-sm d-flex align-items-center justify-content-center gap-2">
                        <img src="https://img.icons8.com/color/24/000000/google-logo.png" alt="Google"> 
                        Lanjutkan dengan Google
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>