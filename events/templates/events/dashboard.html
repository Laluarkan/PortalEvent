{% extends 'events/base.html' %}
{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2>Dashboard Organizer</h2>
            <p class="text-muted">Halo, <strong>{{ display_name }}</strong>. Berikut performa event Anda:</p>
        </div>
        <a href="{% url 'create_event' %}" class="btn btn-primary">+ Buat Seminar</a>
    </div>
    
    <div class="row">
        {% for event in events %}
        <div class="col-md-6 mb-4">
            <div class="card h-100 shadow-sm border-0">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title fw-bold text-primary">{{ event.title }}</h5>
                        {% if event.status == 'active' %}
                            <span class="badge bg-success">Tayang</span>
                        {% elif event.status == 'pending' %}
                            <span class="badge bg-warning text-dark">Review</span>
                        {% else %}
                            <span class="badge bg-danger">Ditolak</span>
                        {% endif %}
                    </div>
                    
                    <p class="text-muted small mb-3">ğŸ“… {{ event.date_time|date:"d M Y, H:i" }}</p>

                    <div class="bg-light p-3 rounded mb-3 border">
                        <div class="row text-center">
                            <div class="col-6 border-end">
                                <small class="text-muted d-block">Harga Tiket</small>
                                <span class="fw-bold">
                                    {% if event.price == 0 %}Gratis{% else %}Rp {{ event.price }}{% endif %}
                                </span>
                            </div>
                            <div class="col-6">
                                <small class="text-muted d-block">Pendapatan</small>
                                <span class="fw-bold text-success">Rp {{ event.current_revenue }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <a href="{% url 'event_participants' event.id %}" class="btn btn-outline-primary btn-sm">
                            ğŸ‘¥ Peserta ({{ event.participants.count }})
                        </a>
                        
                        {% if event.status == 'active' %}
                        <div class="btn-group">
                            <a href="{% url 'export_participants' event.id %}" class="btn btn-success btn-sm" title="Download Excel">Download Excel</a>
                            <a href="{% url 'blast_email' event.id %}" class="btn btn-warning btn-sm" title="Kirim Email">Kirim Email</a>
                            
                            {% url 'event_detail' event.slug as link_url %}
                            <button type="button" class="btn btn-secondary btn-sm" 
                                    onclick="shareEvent('{{ event.title|escapejs }}', '{{ event.description|escapejs }}', '{{ link_url }}')">
                                Salin Link
                            </button>

                            <a href="{% url 'finish_event' event.id %}" 
                               class="btn btn-danger btn-sm fw-bold"
                               onclick="return confirm('Yakin ingin menyelesaikan acara ini? \n\nSetelah ini, link pendaftaran akan ditutup dan peserta bisa mengunduh sertifikat.')">
                                ğŸ Selesai
                            </a>
                        </div>
                        
                        {% elif event.status == 'finished' %}
                            <div class="alert alert-success py-1 px-2 mb-0 text-center small">
                                âœ… Acara Selesai (Sertifikat Terbuka)
                            </div>
                            <a href="{% url 'export_participants' event.id %}" class="btn btn-success btn-sm w-100 mt-2">ğŸ“¥ Download Data Akhir</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5">
            <p class="text-muted">Belum ada event.</p>
        </div>
        {% endfor %}
    </div>

    <script>
        function shareEvent(title, description, slugUrl) {
            let baseUrl = window.location.origin;
            if (baseUrl.endsWith("/")) { baseUrl = baseUrl.slice(0, -1); }
            if (!slugUrl.startsWith("/")) { slugUrl = "/" + slugUrl; }
            const fullUrl = baseUrl + slugUrl;
            const textToCopy = `*${title}*\n\n${description}\n\nğŸ‘‡ Daftar di sini:\n ${fullUrl} `; 
            navigator.clipboard.writeText(textToCopy).then(function() {
                alert('âœ… Info Seminar berhasil disalin!');
            }, function(err) {
                alert('Gagal menyalin teks.');
            });
        }
    </script>
{% endblock %}